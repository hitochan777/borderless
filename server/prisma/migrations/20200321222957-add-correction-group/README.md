# Migration `20200321222957-add-correction-group`

This migration has been generated by Otsuki Hitoshi at 3/21/2020, 10:29:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "quaint"."CorrectionGroup" (
    "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "id" TEXT NOT NULL  ,
    "post" TEXT NOT NULL  ,
    "summaryComment" TEXT NOT NULL  ,
    "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "user" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("user") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("post") REFERENCES "Post"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("summaryComment") REFERENCES "Tweet"("id") ON DELETE CASCADE ON UPDATE CASCADE
) 

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Like" (
    "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "id" TEXT NOT NULL  ,
    "repliable" TEXT NOT NULL  ,
    "user" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("repliable") REFERENCES "Repliable"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("user") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Like" ("createdAt", "id", "repliable", "user") SELECT "createdAt", "id", "repliable", "user" FROM "quaint"."Like"

DROP TABLE "quaint"."Like";

ALTER TABLE "quaint"."new_Like" RENAME TO "Like";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Post" (
    "content" TEXT NOT NULL DEFAULT '' ,
    "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "id" TEXT NOT NULL  ,
    "language" TEXT NOT NULL DEFAULT '' ,
    "published" BOOLEAN NOT NULL DEFAULT false ,
    "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "user" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("user") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Post" ("content", "createdAt", "id", "language", "published", "updatedAt", "user") SELECT "content", "createdAt", "id", "language", "published", "updatedAt", "user" FROM "quaint"."Post"

DROP TABLE "quaint"."Post";

ALTER TABLE "quaint"."new_Post" RENAME TO "Post";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Tweet" (
    "content" TEXT NOT NULL DEFAULT '' ,
    "correction" TEXT   ,
    "correctionGroup" TEXT   ,
    "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "id" TEXT NOT NULL  ,
    "inReplyTo" TEXT NOT NULL  ,
    "post" TEXT NOT NULL  ,
    "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "user" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("inReplyTo") REFERENCES "Repliable"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("user") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("post") REFERENCES "Post"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("correctionGroup") REFERENCES "CorrectionGroup"("id") ON DELETE SET NULL ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Tweet" ("content", "correction", "createdAt", "id", "inReplyTo", "post", "updatedAt", "user") SELECT "content", "correction", "createdAt", "id", "inReplyTo", "post", "updatedAt", "user" FROM "quaint"."Tweet"

DROP TABLE "quaint"."Tweet";

ALTER TABLE "quaint"."new_Tweet" RENAME TO "Tweet";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_LineMarker" (
    "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "id" TEXT NOT NULL  ,
    "post" TEXT NOT NULL  ,
    "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    PRIMARY KEY ("id"),FOREIGN KEY ("post") REFERENCES "Post"("id") ON DELETE CASCADE ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_LineMarker" ("createdAt", "id", "post", "updatedAt") SELECT "createdAt", "id", "post", "updatedAt" FROM "quaint"."LineMarker"

DROP TABLE "quaint"."LineMarker";

ALTER TABLE "quaint"."new_LineMarker" RENAME TO "LineMarker";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200310231817-init..20200321222957-add-correction-group
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource development {
   provider = "sqlite"
-  url = "***"
+  url      = env("DB_URL")
 }
 generator photon {
   provider = "prisma-client-js"
@@ -49,8 +49,20 @@
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
 }
+model CorrectionGroup {
+  id        String  @default(cuid()) @id
+  post      Post
+  user      User
+  summaryComment Tweet
+  corrections Tweet[] @relation(name: "CorrectionTweets")
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+}
+
+
+
 model LineMarker {
   id        String  @default(cuid()) @id
   post      Post
   createdAt DateTime  @default(now())
```


